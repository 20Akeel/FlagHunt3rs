<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CTF Challenges - Flag Hunt3rs</title>
  <link rel="stylesheet" href="style.css">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
</head>

<body>
  <!-- Authenticated User Navigation -->
<nav class="navbar">
  <div class="nav-container">
    <div class="nav-logo">
      <h2>Flag Hunt3rs</h2>
    </div>
    <div class="nav-menu">
      <a href="index.html" class="nav-link">Home</a>
      <a href="javascript:void(0)" onclick="showChallenges()" class="nav-link active">Challenges</a>
      <a href="leaderboard.html" class="nav-link">Leaderboard</a>
      <a href="about-developers.html" class="nav-link">About Developer</a>
      <a href="javascript:void(0)" onclick="showProfile()" class="nav-link">Profile</a>
      <a href="javascript:void(0)" onclick="signOut()" class="nav-link">Sign Out</a>
    </div>
  </div>
</nav>
  <div class="container" style="padding-top: 100px;">
    <header>
      <h1>CTF Challenges</h1>
      <p>Choose your difficulty level and start hacking! Each category contains unique challenges designed to test different aspects of cybersecurity.</p>
    </header>

    <!-- Difficulty Level Selector -->
    <div class="difficulty-selector">
      <button class="difficulty-btn active" data-difficulty="easy" onclick="showDifficulty('easy')">
        <span class="difficulty-icon">üü¢</span>
        <span class="difficulty-text">Easy</span>
        <span class="difficulty-count" id="easyCount">2 Challenges</span>
      </button>
      <button class="difficulty-btn" data-difficulty="medium" onclick="showDifficulty('medium')">
        <span class="difficulty-icon">üü°</span>
        <span class="difficulty-text">Medium</span>
        <span class="difficulty-count" id="mediumCount">3 Challenges</span>
      </button>
      <button class="difficulty-btn" data-difficulty="hard" onclick="showDifficulty('hard')">
        <span class="difficulty-icon">üî¥</span>
        <span class="difficulty-text">Hard</span>
        <span class="difficulty-count" id="hardCount">2 Challenges</span>
      </button>
    </div>

    <main>
      <!-- Easy Challenges -->
      <div id="easy-challenges" class="challenge-section active">
        <div class="section-header">
          <h2>üü¢ Easy Challenges</h2>
          <p>Perfect for beginners! Learn the basics of web security and CTF techniques.</p>
        </div>

        <!-- Easy Challenge 1: Logic Flaw -->
        <div class="challenge-card" id="challenge-easy-1">
          <div class="challenge-header">
            <h3>Challenge 1: Logic Flaw Exploitation</h3>
            <div class="challenge-meta">
              <span class="difficulty-badge easy">Easy</span>
              <span class="points" id="points-easy-1">100 pts</span>
              <span class="solved-badge" id="solved-easy-1" style="display: none;">‚úÖ Solved</span>
            </div>
          </div>
          <p>This login script accepts any user who knows the "right" comparison. But is it secure?</p>
          <p>Find a value that passes this logic: <code>if (input == 1337)</code></p>

          <!-- Hint Section -->
          <div class="hint-section">
            <button class="hint-btn" onclick="revealHint('easy-1', 10)">
              üí° Show Hint (-10 pts)
            </button>
            <div class="hint-content" id="hint-easy-1" style="display: none;">
              <em>Hint: Think about JavaScript's type coercion and loose equality...</em>
            </div>
          </div>

          <form class="flag-form" data-challenge="easy-1">
            <div class="form-group">
              <label for="easy1-flag">Enter Flag:</label>
              <input type="text" id="easy1-flag" class="flag-input" placeholder="flag{...}" required>
            </div>

            <button type="submit">Submit Flag</button>
          </form>

          <div class="challenge-result" id="easy1-result"></div>
        </div>

        <!-- Easy Challenge 2: Base64 Decode -->
        <div class="challenge-card" id="challenge-easy-2">
          <div class="challenge-header">
            <h3>Challenge 2: Base64 Decoding</h3>
            <div class="challenge-meta">
              <span class="difficulty-badge easy">Easy</span>
              <span class="points" id="points-easy-2">150 pts</span>
              <span class="solved-badge" id="solved-easy-2" style="display: none;">‚úÖ Solved</span>
            </div>
          </div>
          <p>Here's your target string:</p>
          <p><code>ZmxhZ3tiYXNlNjRfZGVjb2RlZF9tZX0=</code></p>
          <p>Something tells me... it's not encrypted, just <em>transformed</em>. Can you reverse the transformation?</p>

          <!-- Hint Section -->
          <div class="hint-section">
            <button class="hint-btn" onclick="revealHint('easy-2', 15)">
              üí° Show Hint (-15 pts)
            </button>
            <div class="hint-content" id="hint-easy-2" style="display: none;">
              <em>Hint: This looks like Base64 encoding. Try decoding it online or using browser dev tools!</em>
            </div>
          </div>

          <form class="flag-form" data-challenge="easy-2">
            <div class="form-group">
              <label for="easy2-flag">Enter Flag:</label>
              <input type="text" id="easy2-flag" class="flag-input" placeholder="flag{...}" required>
            </div>

            <button type="submit">Submit Flag</button>
          </form>

          <div class="challenge-result" id="easy2-result"></div>
        </div>
      </div>

      <!-- Medium Challenges -->
      <div id="medium-challenges" class="challenge-section">
        <div class="section-header">
          <h2>üü° Medium Challenges</h2>
          <p>Step up your game! These challenges require deeper understanding of security concepts.</p>
        </div>

        <!-- Medium Challenge 1: Hidden JavaScript -->
        <div class="challenge-card" id="challenge-medium-1">
          <div class="challenge-header">
            <h3>Challenge 1: Hidden JavaScript Function</h3>
            <div class="challenge-meta">
              <span class="difficulty-badge medium">Medium</span>
              <span class="points" id="points-medium-1">200 pts</span>
              <span class="solved-badge" id="solved-medium-1" style="display: none;">‚úÖ Solved</span>
            </div>
          </div>
          <p>The page hides the flag from plain sight... but is it really gone?</p>
          <p>Your goal is to find and run a hidden JavaScript function in Dev Tools.</p>

          <!-- Hint Section -->
          <div class="hint-section">
            <button class="hint-btn" onclick="revealHint('medium-1', 20)">
              üí° Show Hint (-20 pts)
            </button>
            <div class="hint-content" id="hint-medium-1" style="display: none;">
              <em>Hint: Try calling <code>revealFlag()</code> in the browser console...</em>
            </div>
          </div>

          <form class="flag-form" data-challenge="medium-1">
            <div class="form-group">
              <label for="medium1-flag">Enter Flag:</label>
              <input type="text" id="medium1-flag" class="flag-input" placeholder="flag{...}" required>
            </div>

            <button type="submit">Submit Flag</button>
          </form>

          <div class="challenge-result" id="medium1-result"></div>
        </div>

        <!-- Medium Challenge 2: SQL Injection Simulation -->
        <div class="challenge-card" id="challenge-medium-2">
          <div class="challenge-header">
            <h3>Challenge 2: SQL Injection Basics</h3>
            <div class="challenge-meta">
              <span class="difficulty-badge medium">Medium</span>
              <span class="points" id="points-medium-2">250 pts</span>
              <span class="solved-badge" id="solved-medium-2" style="display: none;">‚úÖ Solved</span>
            </div>
          </div>
          <p>A vulnerable login form awaits your expertise. Can you bypass the authentication?</p>
          <p>Try different SQL injection payloads to find the hidden flag.</p>

          <!-- Hint Section -->
          <div class="hint-section">
            <button class="hint-btn" onclick="revealHint('medium-2', 25)">
              üí° Show Hint (-25 pts)
            </button>
            <div class="hint-content" id="hint-medium-2" style="display: none;">
              <em>Hint: What happens when you try <code>' OR '1'='1</code> as username?</em>
            </div>
          </div>

          <div class="sql-challenge">
            <div class="sql-form">
              <h4>Vulnerable Login Form</h4>
              <form id="sqlForm">
                <div class="form-group">
                  <label for="sqlUsername">Username:</label>
                  <input type="text" id="sqlUsername" placeholder="admin">
                </div>
                <div class="form-group">
                  <label for="sqlPassword">Password:</label>
                  <input type="password" id="sqlPassword" placeholder="password">
                </div>
                <button type="button" onclick="attemptSQLLogin()">Login</button>
              </form>
              <div id="sqlResponse" class="sql-response"></div>
            </div>
          </div>

          <form class="flag-form" data-challenge="medium-2">
            <div class="form-group">
              <label for="medium2-flag">Enter Flag:</label>
              <input type="text" id="medium2-flag" class="flag-input" placeholder="flag{...}" required>
            </div>

            <button type="submit">Submit Flag</button>
          </form>

          <div class="challenge-result" id="medium2-result"></div>
        </div>

        <!-- Medium Challenge 3: Cookie Manipulation -->
        <div class="challenge-card" id="challenge-medium-3">
          <div class="challenge-header">
            <h3>Challenge 3: Cookie Manipulation</h3>
            <div class="challenge-meta">
              <span class="difficulty-badge medium">Medium</span>
              <span class="points" id="points-medium-3">300 pts</span>
              <span class="solved-badge" id="solved-medium-3" style="display: none;">‚úÖ Solved</span>
            </div>
          </div>
          <p>This application uses cookies to control access. Can you manipulate them to gain admin privileges?</p>
          <p>Check your browser's developer tools and examine the cookies set by this page.</p>

          <!-- Hint Section -->
          <div class="hint-section">
            <button class="hint-btn" onclick="revealHint('medium-3', 30)">
              üí° Show Hint (-30 pts)
            </button>
            <div class="hint-content" id="hint-medium-3" style="display: none;">
              <em>Hint: Look for a cookie named 'role' and try changing its value...</em>
            </div>
          </div>

          <div class="cookie-challenge">
            <button onclick="checkCookieAccess()" class="btn-secondary">Check Access Level</button>
            <div id="cookieStatus" class="cookie-status"></div>
          </div>

          <form class="flag-form" data-challenge="medium-3">
            <div class="form-group">
              <label for="medium3-flag">Enter Flag:</label>
              <input type="text" id="medium3-flag" class="flag-input" placeholder="flag{...}" required>
            </div>

            <button type="submit">Submit Flag</button>
          </form>

          <div class="challenge-result" id="medium3-result"></div>
        </div>
      </div>

      <!-- Hard Challenges -->
      <div id="hard-challenges" class="challenge-section">
        <div class="section-header">
          <h2>üî¥ Hard Challenges</h2>
          <p>Expert level! These challenges require advanced techniques and creative thinking.</p>
        </div>

        <!-- Hard Challenge 1: XSS Challenge -->
        <div class="challenge-card" id="challenge-hard-1">
          <div class="challenge-header">
            <h3>Challenge 1: Cross-Site Scripting (XSS)</h3>
            <div class="challenge-meta">
              <span class="difficulty-badge hard">Hard</span>
              <span class="points" id="points-hard-1">400 pts</span>
              <span class="solved-badge" id="solved-hard-1" style="display: none;">‚úÖ Solved</span>
            </div>
          </div>
          <p>Find a way to execute JavaScript code in this vulnerable comment system.</p>
          <p>Your goal is to trigger an alert box showing the hidden flag.</p>

          <!-- Hint Section -->
          <div class="hint-section">
            <button class="hint-btn" onclick="revealHint('hard-1', 40)">
              üí° Show Hint (-40 pts)
            </button>
            <div class="hint-content" id="hint-hard-1" style="display: none;">
              <em>Hint: Try injecting script tags in the comment field...</em>
            </div>
          </div>

          <div class="xss-challenge">
            <div class="comment-system">
              <h4>Comment System</h4>
              <form id="commentForm">
                <div class="form-group">
                  <label for="commentName">Name:</label>
                  <input type="text" id="commentName" placeholder="Your name">
                </div>
                <div class="form-group">
                  <label for="commentText">Comment:</label>
                  <textarea id="commentText" placeholder="Leave a comment..." rows="3"></textarea>
                </div>
                <button type="button" onclick="submitComment()">Post Comment</button>
              </form>
              <div id="commentsDisplay" class="comments-display"></div>
            </div>
          </div>

          <form class="flag-form" data-challenge="hard-1">
            <div class="form-group">
              <label for="hard1-flag">Enter Flag:</label>
              <input type="text" id="hard1-flag" class="flag-input" placeholder="flag{...}" required>
            </div>

            <button type="submit">Submit Flag</button>
          </form>

          <div class="challenge-result" id="hard1-result"></div>
        </div>

        <!-- Hard Challenge 2: Advanced Logic Bypass -->
        <div class="challenge-card" id="challenge-hard-2">
          <div class="challenge-header">
            <h3>Challenge 2: Advanced Authentication Bypass</h3>
            <div class="challenge-meta">
              <span class="difficulty-badge hard">Hard</span>
              <span class="points" id="points-hard-2">500 pts</span>
              <span class="solved-badge" id="solved-hard-2" style="display: none;">‚úÖ Solved</span>
            </div>
          </div>
          <p>This advanced authentication system has multiple layers of protection. Can you bypass them all?</p>
          <p>You'll need to combine multiple techniques to succeed.</p>

          <!-- Hint Section -->
          <div class="hint-section">
            <button class="hint-btn" onclick="revealHint('hard-2', 50)">
              üí° Show Hint (-50 pts)
            </button>
            <div class="hint-content" id="hint-hard-2" style="display: none;">
              <em>Hint: Sometimes the answer is hidden in the client-side validation...</em>
            </div>
          </div>

          <div class="advanced-auth">
            <div class="auth-system">
              <h4>Secure Authentication System v2.0</h4>
              <form id="advancedAuthForm">
                <div class="form-group">
                  <label for="advUsername">Username:</label>
                  <input type="text" id="advUsername" placeholder="Enter username">
                </div>
                <div class="form-group">
                  <label for="advPassword">Password:</label>
                  <input type="password" id="advPassword" placeholder="Enter password">
                </div>
                <div class="form-group">
                  <label for="advToken">Security Token:</label>
                  <input type="text" id="advToken" placeholder="XXXX-XXXX-XXXX" readonly>
                </div>
                <button type="button" onclick="attemptAdvancedAuth()">Authenticate</button>
              </form>
              <div id="advancedAuthResponse" class="auth-response"></div>
            </div>
          </div>

          <form class="flag-form" data-challenge="hard-2">
            <div class="form-group">
              <label for="hard2-flag">Enter Flag:</label>
              <input type="text" id="hard2-flag" class="flag-input" placeholder="flag{...}" required>
            </div>

            <button type="submit">Submit Flag</button>
          </form>

          <div class="challenge-result" id="hard2-result"></div>
        </div>
      </div>
    </main>
  </div>

<script>
    let currentUser = null;
    let isAuthenticated = false;
    
    const originalChallengePoints = {
      'easy-1': 100,
      'easy-2': 150,
      'medium-1': 200,
      'medium-2': 250,
      'medium-3': 300,
      'hard-1': 400,
      'hard-2': 500
    };

    let hintUsage = {};
    let pointDeductions = {};

    document.addEventListener('DOMContentLoaded', function() {
      checkAuthStatus();
    });

    // Check authentication status with backend
    async function checkAuthStatus() {
      try {
        const response = await fetch('/auth/status');
        const data = await response.json();
        
        if (data.loggedIn) {
          currentUser = { 
            name: data.username,
            username: data.username,
            id: data.userId || data.username
          };
          isAuthenticated = true;
          
          // Load user's hint usage and point deductions
          loadUserProgress();
          
          // Set initial cookie for cookie challenge
          document.cookie = "role=user; path=/";
          
          // Generate security token for advanced auth
          const tokenElement = document.getElementById('advToken');
          if (tokenElement) {
            tokenElement.value = generateSecurityToken();
          }
          
          // Setup form handlers
          setupFormHandlers();
          
          // Update challenge status
          updateChallengeStatus();
        } else {
          // Not authenticated, redirect to login
          window.location.href = 'index.html';
          return;
        }
      } catch (error) {
        console.error('Error checking auth status:', error);
        // Fallback to redirect if can't check auth
        window.location.href = 'index.html';
      }
    }

    // Load user's progress (keep localStorage for progress tracking)
    function loadUserProgress() {
      const userProgress = localStorage.getItem(`progress_${currentUser.username}`);
      if (userProgress) {
        const progress = JSON.parse(userProgress);
        hintUsage = progress.hintUsage || {};
        pointDeductions = progress.pointDeductions || {};
      }
    }

    // Save user's progress
    function saveUserProgress() {
      const progress = {
        hintUsage: hintUsage,
        pointDeductions: pointDeductions
      };
      localStorage.setItem(`progress_${currentUser.username}`, JSON.stringify(progress));
    }

    async function updateChallengeStatus() {
      try {
        const response = await fetch('/auth/status');
        const data = await response.json();
        
        if (data.loggedIn && data.solvedChallenges) {
          const solvedChallenges = data.solvedChallenges;
          
          solvedChallenges.forEach(solved => {
            const challengeId = solved.challengeId;
            const solvedBadge = document.getElementById(`solved-${challengeId}`);
            const challengeCard = document.getElementById(`challenge-${challengeId}`);
            
            if (solvedBadge && challengeCard) {
              solvedBadge.style.display = 'inline-block';
              challengeCard.classList.add('solved');
              
              // Disable the form
              const form = challengeCard.querySelector('.flag-form');
              if (form) {
                const inputs = form.querySelectorAll('input, button');
                inputs.forEach(input => {
                  input.disabled = true;
                });
                
                // Show solved message with proper date
                const resultDiv = challengeCard.querySelector('.challenge-result');
                if (resultDiv && !resultDiv.innerHTML.includes('Solved on')) {
                  const solvedDate = new Date(solved.timestamp).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                  });
                  resultDiv.innerHTML = `<div class="success">‚úÖ Solved on ${solvedDate}</div>`;
                }
              }
            }
          });
        }
      } catch (error) {
        console.error('Error fetching solved challenges:', error);
      }

      // Update points display with deductions
      Object.keys(originalChallengePoints).forEach(challengeId => {
        const pointsElement = document.getElementById(`points-${challengeId}`);
        if (pointsElement) {
          const deduction = pointDeductions[challengeId] || 0;
          const currentPoints = originalChallengePoints[challengeId] - deduction;
          pointsElement.textContent = `${currentPoints} pts`;
          
          if (deduction > 0) {
            pointsElement.style.color = 'var(--warning-color)';
            pointsElement.title = `Original: ${originalChallengePoints[challengeId]} pts, Deducted: ${deduction} pts`;
          }
        }
      });

      // Show already revealed hints
      Object.keys(hintUsage).forEach(challengeId => {
        if (hintUsage[challengeId]) {
          const hintContent = document.getElementById(`hint-${challengeId}`);
          const hintBtn = document.querySelector(`[onclick*="revealHint('${challengeId}'"]`);
          
          if (hintContent && hintBtn) {
            hintContent.style.display = 'block';
            hintBtn.textContent = 'üí° Hint Revealed';
            hintBtn.disabled = true;
            hintBtn.style.opacity = '0.6';
          }
        }
      });
    }

    // Reveal hint function
    function revealHint(challengeId, deduction) {
      // Check if hint already revealed
      if (hintUsage[challengeId]) {
        return;
      }

      const confirmation = confirm(`Are you sure you want to reveal the hint? This will deduct ${deduction} points from this challenge.`);
      
      if (confirmation) {
        // Mark hint as used
        hintUsage[challengeId] = true;
        pointDeductions[challengeId] = (pointDeductions[challengeId] || 0) + deduction;
        
        // Save progress
        saveUserProgress();
        
        // Show hint
        const hintContent = document.getElementById(`hint-${challengeId}`);
        const hintBtn = event.target;
        
        hintContent.style.display = 'block';
        hintBtn.textContent = 'üí° Hint Revealed';
        hintBtn.disabled = true;
        hintBtn.style.opacity = '0.6';
        
        // Update points display
        const pointsElement = document.getElementById(`points-${challengeId}`);
        const newPoints = originalChallengePoints[challengeId] - pointDeductions[challengeId];
        pointsElement.textContent = `${newPoints} pts`;
        pointsElement.style.color = 'var(--warning-color)';
        pointsElement.title = `Original: ${originalChallengePoints[challengeId]} pts, Deducted: ${pointDeductions[challengeId]} pts`;
        
        // Show notification
        showNotification(`Hint revealed! ${deduction} points deducted.`, 'warning');
      }
    }

    // Show notification
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: var(--bg-card);
        color: var(--text-primary);
        padding: 15px 20px;
        border-radius: 8px;
        border-left: 4px solid var(--${type === 'warning' ? 'warning' : type === 'success' ? 'success' : 'primary'}-color);
        box-shadow: var(--shadow-primary);
        z-index: 10000;
        animation: slideIn 0.3s ease;
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }

    // Difficulty switching
    function showDifficulty(difficulty) {
      // Update buttons
      document.querySelectorAll('.difficulty-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelector(`[data-difficulty="${difficulty}"]`).classList.add('active');
      
      // Show/hide sections
      document.querySelectorAll('.challenge-section').forEach(section => {
        section.classList.remove('active');
      });
      document.getElementById(`${difficulty}-challenges`).classList.add('active');
    }

      function revealFlag() {
      console.log("üéâ Nice find! Check the network tab or submit your flag to see if it's correct!");
      return "Submit your flag to verify!";
    }

      function attemptSQLLogin() {
      const username = document.getElementById('sqlUsername').value;
      const password = document.getElementById('sqlPassword').value;
      const response = document.getElementById('sqlResponse');
      
      if (username.includes("' OR '1'='1") || username.includes("' OR 1=1") || 
          username.includes("admin'--") || username.includes("' UNION")) {
        
        response.innerHTML = `
          <div class="success">
            üéâ SQL Injection successful!<br>
            <strong>Great! Now submit the flag you found to earn points.</strong>
          </div>
        `;
      } else if (username === 'admin' && password === 'password') {
        response.innerHTML = '<div class="error">Valid credentials, but no flag here! Try injection techniques.</div>';
      } else {
        response.innerHTML = '<div class="error">Invalid credentials. Try SQL injection techniques!</div>';
      }
    }

      function checkCookieAccess() {
      const cookies = document.cookie.split(';');
      let role = 'guest';
      
      cookies.forEach(cookie => {
        const [name, value] = cookie.trim().split('=');
        if (name === 'role') {
          role = value;
        }
      });
      
      const status = document.getElementById('cookieStatus');
      
      if (role === 'admin') {
        status.innerHTML = `
          <div class="success">
            üéâ Admin access granted!<br>
            <strong>Great! Now submit the flag you found to earn points.</strong>
          </div>
        `;
      } else {
        status.innerHTML = `
          <div class="info">
            Current role: <strong>${role}</strong><br>
            You need admin privileges to access the flag. Try manipulating the cookies!
          </div>
        `;
      }
    }

      function submitComment() {
      const name = document.getElementById('commentName').value;
      const comment = document.getElementById('commentText').value;
      const display = document.getElementById('commentsDisplay');
      
      const commentHTML = `
        <div class="comment">
          <strong>${name}:</strong> ${comment}
        </div>
      `;
      
      display.innerHTML += commentHTML;
      
      // Check if XSS was successful
      if (comment.includes('<script>') && comment.includes('alert')) {
        setTimeout(() => {
          alert('üéâ XSS Success! Great job! Now submit your flag to earn points.');
        }, 500);
      }
    }

    // Advanced authentication challenge
    function generateSecurityToken() {
      // Weak token generation - predictable pattern
      const timestamp = Date.now().toString().slice(-4);
      return `HACK-${timestamp}-CTFL`;
    }

      function attemptAdvancedAuth() {
      const username = document.getElementById('advUsername').value;
      const password = document.getElementById('advPassword').value;
      const token = document.getElementById('advToken').value;
      const response = document.getElementById('advancedAuthResponse');
      
      // Multiple bypass opportunities
      if (username === 'admin' && password === 'password123' && token.startsWith('HACK-')) {
        response.innerHTML = `
          <div class="success">
            üéâ Authentication bypassed successfully!<br>
            <strong>Excellent! Now submit your flag to earn points.</strong>
          </div>
        `;
      } else if (username.length === 0 && password.length === 0) {
        response.innerHTML = '<div class="error">Empty credentials not allowed!</div>';
      } else {
        response.innerHTML = '<div class="error">Access denied. Try different approaches!</div>';
      }
    }

      function setupFormHandlers() {
      document.querySelectorAll('.flag-form').forEach(form => {
        form.addEventListener('submit', async function(e) {
          e.preventDefault();
          
          const challengeId = this.dataset.challenge;
          const flagInput = this.querySelector('.flag-input');
          const resultDiv = this.parentElement.querySelector('.challenge-result');
          const submitButton = this.querySelector('button[type="submit"]');
          
          const submittedFlag = flagInput.value.trim();
          
          if (!submittedFlag) {
            resultDiv.innerHTML = '<div class="error">‚ùå Please enter a flag!</div>';
            return;
          }

          // Disable submit button during processing
          submitButton.disabled = true;
          submitButton.textContent = 'Checking...';
          resultDiv.innerHTML = '<div class="info">üîç Verifying flag...</div>';
          
          try {
            // Submit to backend for validation
            const response = await submitToBackend(challengeId, submittedFlag);
            
            if (response && response.success) {
              // Calculate actual points earned
              const basePoints = originalChallengePoints[challengeId];
              const deduction = pointDeductions[challengeId] || 0;
              const earnedPoints = Math.max(0, basePoints - deduction);
              
              // Show success message with date
              const solvedDate = new Date().toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long', 
                day: 'numeric'
              });
              
              resultDiv.innerHTML = `<div class="success">‚úÖ Correct! Challenge solved on ${solvedDate}. You earned ${earnedPoints} points!</div>`;
              
              // Update UI to show solved state
              const solvedBadge = document.getElementById(`solved-${challengeId}`);
              const challengeCard = document.getElementById(`challenge-${challengeId}`);
              
              if (solvedBadge) solvedBadge.style.display = 'inline-block';
              if (challengeCard) challengeCard.classList.add('solved');
              
              // Disable form
              const inputs = this.querySelectorAll('input, button');
              inputs.forEach(input => {
                input.disabled = true;
              });
              
              // Show notification
              showNotification(`Challenge solved! You earned ${earnedPoints} points!`, 'success');
              
              // Refresh auth status to update solved challenges
              setTimeout(() => {
                checkAuthStatus();
              }, 1000);
              
            } else {
              // Show error message for incorrect attempts
              const errorMessages = [
                "‚ùå Wrong flag. Try harder!",
                "‚ùå Not quite right. Keep investigating!",
                "‚ùå Close, but not correct. Think differently!",
                "‚ùå Incorrect. The flag is still hidden..."
              ];
              resultDiv.innerHTML = `<div class="error">${errorMessages[Math.floor(Math.random() * errorMessages.length)]}</div>`;
            }
          } catch (error) {
            console.error('Error submitting flag:', error);
            resultDiv.innerHTML = '<div class="error">‚ùå Error submitting flag. Please try again.</div>';
          } finally {
            // Re-enable submit button
            submitButton.disabled = false;
            submitButton.textContent = 'Submit Flag';
          }
        });
      });
    }

    async function submitToBackend(challengeId, submittedFlag) {
      try {
        const response = await fetch('/flags/submit', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            challengeId: challengeId,
            submittedFlag: submittedFlag,
            username: currentUser.username,
            email: currentUser.email || '',
            hintDeductions: pointDeductions[challengeId] || 0
          })
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        console.log('Backend response:', data);
        return data;
      } catch (error) {
        console.error('Backend error:', error);
        throw error;
      }
    }

    // Navigation functions
    function showChallenges() {
      // Already on challenges page
    }

    function showProfile() {
      window.location.href = 'profile.html';
    }

    // Sign out function
    async function signOut() {
      try {
        const response = await fetch('/auth/logout', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        });

        if (response.ok) {
          currentUser = null;
          isAuthenticated = false;
          window.location.href = 'index.html';
        }
      } catch (error) {
        console.error('Error signing out:', error);
        // Fallback - just redirect
        window.location.href = 'index.html';
      }
    }
</script>

  <style>
    /* CSS Variables */
    :root {
      --primary-green: #00ff88;
      --primary-green-dark: #00cc6a;
      --primary-green-glow: rgba(0, 255, 136, 0.3);
      --bg-primary: #0a0a0f;
      --bg-secondary: #141419;
      --bg-card: #1a1a20;
      --text-primary: #ffffff;
      --text-secondary: #b0b3b8;
      --text-muted: #6b7280;
      --border-color: #2a2a35;
      --success-color: #10b981;
      --warning-color: #f59e0b;
      --danger-color: #ef4444;
      --shadow-primary: 0 4px 20px rgba(0, 0, 0, 0.3);
      --shadow-glow: 0 0 30px var(--primary-green-glow);
    }
    /* Additional styles for enhanced challenges page */
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .notification {
      animation: slideIn 0.3s ease;
    }

    .auth-nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(10, 10, 15, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border-color);
      padding: 15px 0;
      z-index: 1000;
    }

    .auth-nav-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .user-info {
      color: var(--text-primary);
      font-weight: 500;
    }

    .auth-menu {
      display: flex;
      gap: 30px;
    }

    .auth-link {
      color: var(--text-secondary);
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s ease;
    }

    .auth-link:hover, .auth-link.active {
      color: var(--primary-green);
    }

    .difficulty-selector {
      display: flex;
      gap: 20px;
      margin: 40px 0;
      justify-content: center;
    }

    .difficulty-btn {
      background: var(--bg-card);
      border: 2px solid var(--border-color);
      color: var(--text-primary);
      padding: 20px 30px;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      min-width: 150px;
    }

    .difficulty-btn.active {
      border-color: var(--primary-green);
      box-shadow: var(--shadow-glow);
    }

    .difficulty-icon {
      font-size: 2rem;
    }

    .difficulty-text {
      font-weight: 600;
      font-size: 1.1rem;
    }

    .difficulty-count {
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .challenge-section {
      display: none;
    }

    .challenge-section.active {
      display: block;
    }

    .section-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .section-header h2 {
      font-size: 2.5rem;
      margin-bottom: 15px;
    }

    .challenge-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 20px;
    }

    .challenge-meta {
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-end;
    }

    .difficulty-badge {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    .difficulty-badge.easy {
      background: rgba(34, 197, 94, 0.2);
      color: #22c55e;
    }

    .difficulty-badge.medium {
      background: rgba(245, 158, 11, 0.2);
      color: #f59e0b;
    }

    .difficulty-badge.hard {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
    }

    .points {
      color: var(--primary-green);
      font-weight: 600;
    }

    .solved-badge {
      background: rgba(0, 255, 136, 0.2);
      color: var(--success-color);
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .challenge-card.solved {
      opacity: 0.7;
      border-color: var(--success-color);
    }

    .challenge-card.solved::before {
      background: linear-gradient(90deg, var(--success-color), var(--success-color));
    }

    .hint-section {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 15px;
      margin: 20px 0;
    }

    .hint-btn {
      background: linear-gradient(135deg, var(--warning-color), #e6c200);
      color: var(--bg-primary);
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
    }

    .hint-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(255, 217, 61, 0.3);
    }

    .hint-btn:disabled {
      cursor: not-allowed;
      transform: none;
    }

    .hint-content {
      margin-top: 15px;
      padding: 15px;
      background: rgba(255, 217, 61, 0.1);
      border-left: 4px solid var(--warning-color);
      border-radius: 4px;
      color: var(--text-secondary);
    }

    .flag-form {
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
    }

    .challenge-result {
      margin-top: 20px;
    }

    .challenge-result .success {
      background: rgba(0, 255, 136, 0.1);
      border: 1px solid var(--success-color);
      color: var(--success-color);
      padding: 15px;
      border-radius: 8px;
    }

    .challenge-result .error {
      background: rgba(255, 107, 107, 0.1);
      border: 1px solid var(--error-color);
      color: var(--error-color);
      padding: 15px;
      border-radius: 8px;
    }

    /* Challenge-specific styles */
    .sql-challenge, .cookie-challenge, .xss-challenge, .advanced-auth {
      background: var(--bg-secondary);
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
      border: 1px solid var(--border-color);
    }

    .sql-form h4, .comment-system h4, .auth-system h4 {
      color: var(--primary-green);
      margin-bottom: 15px;
    }

    .sql-response, .cookie-status, .comments-display, .auth-response {
      margin-top: 15px;
    }

    .sql-response .success, .cookie-status .success, .auth-response .success {
      background: rgba(0, 255, 136, 0.1);
      border: 1px solid var(--success-color);
      color: var(--success-color);
      padding: 10px;
      border-radius: 6px;
    }

    .sql-response .error, .cookie-status .info, .auth-response .error {
      background: rgba(255, 181, 77, 0.1);
      border: 1px solid var(--warning-color);
      color: var(--warning-color);
      padding: 10px;
      border-radius: 6px;
    }

    .comment {
      background: var(--bg-card);
      padding: 10px;
      margin: 10px 0;
      border-radius: 6px;
      border-left: 3px solid var(--primary-green);
    }

    @media (max-width: 768px) {
      .difficulty-selector {
        flex-direction: column;
        align-items: center;
      }

      .challenge-header {
        flex-direction: column;
        gap: 15px;
      }

      .challenge-meta {
        align-items: flex-start;
      }

      .auth-menu {
        gap: 15px;
        flex-wrap: wrap;
      }
    }
  </style>
</body>
</html>